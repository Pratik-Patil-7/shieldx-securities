<div class="container-fluid min-vh-100 d-flex align-items-center justify-content-center bg-light">
  <div class="card shadow-lg" style="width: 100%; max-width: 500px;">
    <div class="card-body p-4">
      <div class="text-center mb-4">
        <h2 class="font-weight-bold text-primary">Login to ShieldX</h2>
      </div>

      <!-- Email/Password Login Form -->
      <form *ngIf="!showOtpForm && !showResetForm && !showNewPasswordForm"
            #loginForm="ngForm"
            (ngSubmit)="onLogin(loginForm)"
            class="mt-4">
        <div class="form-group mb-4">
          <label for="email" class="form-label">Email Address</label>
          <div class="input-group">
            <span class="input-group-text"><i class="fas fa-envelope"></i></span>
            <input type="email" id="email" name="email"
                   [(ngModel)]="email" required
                   class="form-control form-control-lg"
                   placeholder="Enter your email">
          </div>
        </div>
        <div class="form-group mb-4">
          <label for="password" class="form-label">Password</label>
          <div class="input-group">
            <span class="input-group-text"><i class="fas fa-lock"></i></span>
            <input type="password" id="password" name="password"
                   [(ngModel)]="password" required
                   class="form-control form-control-lg"
                   placeholder="Enter your password">
          </div>
        </div>
        <button type="submit"
                class="btn btn-primary btn-lg w-100 mb-3 shadow"
                [disabled]="!loginForm.valid || isLoading">
          <span *ngIf="!isLoading">Continue to OTP</span>
          <span *ngIf="isLoading"
                class="spinner-border spinner-border-sm"
                role="status"
                aria-hidden="true"></span>
        </button>
        <div class="text-center">
          <a href="#" class="text-decoration-none"
             (click)="onForgotPassword(); $event.preventDefault()">
            Forgot Password?
          </a>
        </div>
        <div *ngIf="errorMessage" class="alert alert-danger mt-3 mb-0 animated fadeIn">
          <i class="fas fa-exclamation-circle me-2"></i>{{ errorMessage }}
        </div>
      </form>

      <!-- OTP Verification Form -->
      <form *ngIf="showOtpForm"
            #otpForm="ngForm"
            (ngSubmit)="onVerifyOtp(otpForm)"
            class="mt-4">
        <div class="text-center mb-4">
          <div class="otp-icon mb-3">
            <i class="fas fa-mobile-alt fa-3x text-primary"></i>
          </div>
          <h5>OTP Verification</h5>
          <p class="text-muted">We've sent a verification code to your email</p>
        </div>

        <div class="form-group mb-4">
          <label for="otpCode" class="form-label">Enter OTP</label>
          <div class="input-group">
            <span class="input-group-text"><i class="fas fa-key"></i></span>
            <input type="text" id="otpCode" name="otpCode"
                   [(ngModel)]="otpCode" required
                   class="form-control form-control-lg"
                   placeholder="6-digit code">
          </div>
        </div>

        <div class="d-flex justify-content-between mb-4">
          <div class="text-muted">
            <small>Code expires in: {{ otpTimer | number:'2.0-0' | date:'mm:ss' }}</small>
          </div>
          <a href="#" class="text-primary"
             (click)="onResendOtp(); $event.preventDefault()"
             [class.disabled]="resendDisabled || isResendingOtp">
            <small *ngIf="!resendDisabled && !isResendingOtp">Resend OTP</small>
            <small *ngIf="resendDisabled || isResendingOtp">Resend in {{ resendCountdown | number:'2.0-0' }}s</small>
          </a>
        </div>

        <button type="submit"
                class="btn btn-primary btn-lg w-100 mb-3 shadow"
                [disabled]="!otpForm.valid || isLoading || otpTimer === 0">
          <span *ngIf="!isLoading">Verify & Login</span>
          <span *ngIf="isLoading"
                class="spinner-border spinner-border-sm"
                role="status"
                aria-hidden="true"></span>
        </button>

        <div class="text-center">
          <a href="#" class="text-decoration-none"
             (click)="backToLogin(); $event.preventDefault()">
            <i class="fas fa-arrow-left me-1"></i> Back to Login
          </a>
        </div>

        <div *ngIf="errorMessage" class="alert alert-danger mt-3 mb-0 animated fadeIn">
          <i class="fas fa-exclamation-circle me-2"></i>{{ errorMessage }}
        </div>
      </form>

      <!-- Password Reset Request Form -->
      <form *ngIf="showResetForm"
            #resetForm="ngForm"
            (ngSubmit)="onSendResetOtp(resetForm)">
        <div class="form-group mb-3">
          <label for="resetEmail" class="form-label">Email</label>
          <input type="email" id="resetEmail" name="resetEmail"
                 [(ngModel)]="resetEmail" required
                 class="form-control form-control-lg"
                 placeholder="Enter your email">
        </div>
        <button type="submit"
                class="btn btn-primary btn-lg w-100 mb-3"
                [disabled]="!resetForm.valid || isLoading">
          <span *ngIf="!isLoading">Send OTP</span>
          <span *ngIf="isLoading"
                class="spinner-border spinner-border-sm"
                role="status"
                aria-hidden="true"></span>
        </button>
        <div class="text-center">
          <a href="#" class="text-decoration-none"
             (click)="showResetForm = false; $event.preventDefault()">
            Back to Login
          </a>
        </div>
        <div *ngIf="errorMessage" class="alert alert-danger mt-3 mb-0">
          {{ errorMessage }}
        </div>
      </form>

      <!-- New Password Form -->
      <form *ngIf="showNewPasswordForm"
            #newPasswordForm="ngForm"
            (ngSubmit)="onResetPassword(newPasswordForm)">
        <div class="form-group mb-3">
          <label for="otpCode" class="form-label">OTP Code</label>
          <input type="text" id="otpCode" name="otpCode"
                 [(ngModel)]="otpCode" required
                 class="form-control form-control-lg"
                 placeholder="Enter OTP code">
        </div>
        <div class="form-group mb-3">
          <label for="newPassword" class="form-label">New Password</label>
          <input type="password" id="newPassword" name="newPassword"
                 [(ngModel)]="newPassword" required
                 class="form-control form-control-lg"
                 placeholder="Enter new password">
        </div>
        <div class="form-group mb-3">
          <label for="confirmPassword" class="form-label">Confirm Password</label>
          <input type="password" id="confirmPassword" name="confirmPassword"
                 [(ngModel)]="confirmPassword" required
                 class="form-control form-control-lg"
                 placeholder="Confirm new password">
        </div>
        <button type="submit"
                class="btn btn-primary btn-lg w-100 mb-3"
                [disabled]="!newPasswordForm.valid || isLoading">
          <span *ngIf="!isLoading">Reset Password</span>
          <span *ngIf="isLoading"
                class="spinner-border spinner-border-sm"
                role="status"
                aria-hidden="true"></span>
        </button>
        <div class="text-center">
          <a href="#" class="text-decoration-none"
             (click)="showNewPasswordForm = false; $event.preventDefault()">
            Back to Login
          </a>
        </div>
        <div *ngIf="errorMessage" class="alert alert-danger mt-3 mb-0">
          {{ errorMessage }}
        </div>
      </form>
    </div>
  </div>
</div>
